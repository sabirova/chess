package com.chessgame.server;

import com.chessgame.game.Player;
import com.chessgame.messenger.Command;
import com.chessgame.messenger.Message;
import com.chessgame.messenger.Messenger;
import javax.xml.bind.JAXBException;
import java.io.*;


public class ClientThreadMessenger {

    private final Messenger messenger;
    private Player player;

    public ClientThreadMessenger(Messenger messenger) {
        this.messenger = messenger;
        try{
            messenger.getSocket().getOutputStream().flush();
        } catch(IOException ex) {
            ex.printStackTrace();
        }

    }

    public Messenger getMessenger() {
        return messenger;
    }

    public void waitMessage() throws IOException{
        try {
            Message message = messenger.getMessage();
            if (message == null) {
                return;
            }
            readMessage(message);
        } catch (JAXBException ex) {
            ex.printStackTrace();
        }
    }

    public void readMessage(Message message)  throws IOException, JAXBException{
        switch (message.getCommand()) {
            case TURN: {

            }
            case EXIT: {

            }
            case LOGIN: {
                login(message.getText());
            }
            case JOIN: {

            }
            case ACCEPT: {

            }
            case SERVER: {
                System.out.println(message.getText());
            }
        }
    }

    public void login(String name) throws JAXBException,IOException{
        player = new Player(name);
        if (!Server.clients.containsKey(player)) {
            Server.clients.put(player, messenger);
            messenger.sendMessage(new Message(Command.SERVER, "Success login"));
        } else {
            messenger.sendMessage(new Message(Command.ERROR, "You have already logged in"));
        }

    }






}
